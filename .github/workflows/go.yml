name: Unit-Tests
on:
  pull_request:
    paths:
      - 'go.mod'
      - '**.go'
      - '**.yml'
  push:
    paths:
      - 'go.mod'
      - '**.go'
      - '**.yml'

jobs:

  test:
    name: Test on go ${{ matrix.go_version }} and ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        go_version: ['1.20']

    steps:
    - name: Check out code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Setup Go Faster
      uses: WillAbides/setup-go-faster@v1.8.0
      timeout-minutes: 3
      with:
        go-version: ${{ matrix.go_version }}

    #mkdir -p ${{ github.workspace }}/go/src/github.com/${{ github.repository }}
    - name: Prepare go workspace
      run: |
        echo "GOPATH=${{ github.workspace }}/go" >> $GITHUB_ENV
        echo "${{ github.workspace }}/go/bin" >> $GITHUB_PATH

    - name: Run unit tests
      # run: go test -v -cover ./...
      # must add " for profile.cov on Windows OS
      # go test -v -coverprofile="profile.cov" ./...
      run: |
        echo ${{ github.workspace }}
        pwd
        make install
        kite -V
        kite

